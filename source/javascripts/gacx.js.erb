(function() {
  function getScript(src, callback) {
    var s = document.createElement('script');
    s.src = src;
    s.async = true;
    s.onreadystatechange = s.onload = function() {
      if (!callback.done && (!s.readyState || /loaded|complete/.test(s.readyState))) {
        callback.done = true;
        callback();
      }
    };
    document.querySelector('head').appendChild(s);
  }

  function showElement(element) {
    switch (element.tagName.toLowerCase()) {
    case 'span':
      element.style.display = "inline";
      break;
    case 'div':
    default:
      element.style.display = "block";
      break;
    }
  }

  function hideElement(element) {
    element.style.display = "none";
  }

  function showVersion(version) {
    var elements = document.querySelectorAll('.version-' + version);
    for (var i = 0; i < elements.length; i++) {
      showElement(elements[i]);
    }
  }

  function hideVersion(version) {
    var elements = document.querySelectorAll('.version-' + version);
    for (var i = 0; i < elements.length; i++) {
      hideElement(elements[i]);
    }
  }

  var googleExperimentId = '_47Yx-h3Q8yPw3Y1nBpZtw';

  getScript('https://www.google-analytics.com/cx/api.js?experiment=' + googleExperimentId, function () {
    var version = cxApi.chooseVariation();

    var switchVersions;
    if (version > 0) {
      switchVersions = function () {
        showVersion(version);
        hideVersion(0);
      };
      switchVersions();
    }

    var complete = function () {
      if (switchVersions) {
        switchVersions();
      }
      ga('send', 'event', 'experiments', 'esv-vs-cev', 'version', version, {'nonInteraction': 1})
    };

    if (window.addEventListener) {
      window.addEventListener('load', complete, false);
    } else if (window.attachEvent)  {
      window.attachEvent('onclick', complete);
    }
  });
}());
